<% provide(:title, 'Manage Supervisors - PolyU FYP Management') %>
<div class="container">
    <h2 class="display-2" style="margin:1em 0 0.4em 0">Manage Supervisors</h2>
    <% if is_admin? %>
    <h5 class="display-5">You are viewing all supervisors.</h5>
    <% else %>
    <h5 class="display-5">You are viewing supervisors from <%= current_user.department %>.</h5>
    <% end %>
    <br>
    <%= form_for(@supervisor, url: supervisors_path) do |f| %>
        <%= render 'shared/error_messages', obj: @supervisor %>
        <p>Add new supervisor:</p>
        <div class="row">
            <div class="form-group col-md-4">
            <%= f.text_field :name, class: "form-control", placeholder: "enter supervisor name" %>
            </div>
            <div class="form-group col-md-4">
            <%= f.text_field :netID, class: "form-control", placeholder: "enter supervisor netID" %>
            </div>
            <% if is_admin? %>
            <div class="form-group col-md-12">
            <%= f.select :department, @departments_list, {prompt: "Select Department:"}, {class: "form-control"} %>
            </div>
            <% else %>
            <%= f.hidden_field :department, value: current_user.department %>
            <% end %>
        </div>
        <%= f.submit "Create supervisor", class: "btn btn-primary" %>
    <% end %>
    <br>
    <br>
    <table class="table manage-table" style="font-size:14px; width:100%">
        <thead>
            <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">NetID</th>
            <% if is_admin? %>
            <th scope="col">Department</th>
            <% end %>
            <th scope="col">Students</th>
            <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            <% @supervisors.each do |supervisor| %>
                <tr>
                    <th scope="row"><%= supervisor.id %></th>
                    <td><%= supervisor.name %></td>
                    <td><%= supervisor.netID %></td>
                    <% if is_admin? %>
                    <td><%= supervisor.department %></td>
                    <% end %>
                    <td>
                    <div class="col-sm-12">
                    <% supervisor.students.each do |student| %>
                        <div class="row" style="margin-bottom:0.3em;margin-right:5px">
                        <div class="col-sm-4">
                        <%= student.netID %>
                        </div>
                        <div class="col-sm-4">
                        <%= student.fyp_year %>
                        </div>
                        <%= form_for @supervisor, :url => {:action => "removeStudent"}, html: {class: "col-sm-3"} do |f| %>
                            <%= hidden_field_tag :stu_netID, student.netID %>
                            <%= hidden_field_tag :sup_netID, supervisor.netID %>
                            <%= f.submit "remove", class: "btn btn-sm btn-white", style: "padding-top:0.1em;border-radius:0.5rem" %>
                        <% end %>
                        </div>
                    <% end %>
                    </div>
                    </td>
                    <td>
                        <%= link_to supervisor, method: :get, data: {} do %>
                            <button class="btn btn-sm btn-info" style="width:35px"><i class="fas fa-user-edit"></i></button>
                        <% end %>
                        <%= link_to supervisor, method: :delete,
                                    data: { confirm: "Do you want to delete this supervisor?" } do %>
                            <button class="btn btn-sm btn-danger" style="width:35px"><i class="fas fa-trash"></i></button>
                        <% end %>
                    </td>
                </tr>
            <% end %>
        </tbody>
    </table>
</div>